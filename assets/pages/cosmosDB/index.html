<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmos Database JSON Generator</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="stylesheet" href="mmit-application-styles.css">
</head>
<body>
    <div class="container">
        <h1>Cosmos JSON</h1>
        <form id="cosmosForm">
            <!-- TEMPLATES SECTION -->
            <div class="form-section">
                <h3>Templates</h3>
                <div id="templatesContainer" class="dynamic-list">
                    <div class="dynamic-item template-item">
                        <details open>
                            <summary class="template-summary">Template 1</summary>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Template Name *</label>
                                    <input type="text" class="template-name" placeholder="e.g., Wellness Works Formulary" required>
                                </div>
                                <div class="form-group">
                                    <label>Client ID *</label>
                                    <input type="number" class="template-client-id" placeholder="e.g., 14226" required>
                                </div>
                                <div class="form-group">
                                    <label>Waypath Name</label>
                                    <input type="text" class="template-waypath" placeholder="">
                                </div>
                                <div class="form-group">
                                    <label>Template File Name *</label>
                                    <input type="text" class="template-filename" placeholder="e.g., Wellness/Wellness Works Formulary.html" required>
                                </div>
                                <div class="form-group">
                                    <label>Template Email File Name</label>
                                    <input type="text" class="template-email-filename" placeholder="">
                                </div>
                                <div class="form-group">
                                    <label>Template Type *</label>
                                    <input type="text" class="template-type" placeholder="HCP" required>
                                </div>
                                <div class="form-group">
                                    <label>Template Product ID *</label>
                                    <input type="number" class="template-product-id" placeholder="e.g., ******" required>
                                </div>
                                <div class="form-group">
                                    <label>Template ID *</label>
                                    <input type="number" class="template-id" placeholder="e.g., *****" required>
                                </div>
                                <div class="form-group">
                                    <label>Project ID *</label>
                                    <input type="number" class="template-project-id" placeholder="e.g., ****" required>
                                </div>
                                <div class="form-group full">
                                    <label>Indication IDs (comma-separated)</label>
                                    <input type="text" class="template-indications" placeholder="e.g., ***, ***, ***">
                                </div>
                                <div class="form-group full" style="display: flex; align-items: flex-end;">
                                    <button type="button" class="btn-remove" onclick="removeTemplate(this)">Remove Template</button>
                                </div>
                            </div>
                        </details>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addTemplate()">+ Add Template</button>
            </div>

            <!-- INDICATIONS SECTION -->
            <div class="form-section">
                <h3>Indications</h3>
                <div id="indicationsContainer" class="dynamic-list">
                    <div class="dynamic-item">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Indication ID *</label>
                                <input type="number" class="indication-id" placeholder="e.g., ***" required>
                            </div>
                            <div class="form-group">
                                <label>Indication Name *</label>
                                <input type="text" class="indication-name" placeholder="e.g., Pharma Plus Hub (P+H)" required>
                            </div>
                            <div class="form-group" style="display: flex; align-items: flex-end;">
                                <button type="button" class="btn-remove" onclick="removeIndication(this)">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn-add" onclick="addIndication()">+ Add Indication</button>
            </div>

            <div class="button-group">
                <button type="button" class="btn-generate" onclick="generateJSON()">Generate JSON</button>
                <button type="button" class="btn-copy" onclick="copyJSON()">Copy JSON</button>
                <button type="button" class="btn-download" onclick="downloadJSON()">Download JSON</button>
                <button type="button" class="btn-clear" onclick="clearForm()">Clear</button>
                <!-- <button type="button" class="btn-sample" onclick="loadSampleData()" style="background: #2196F3;">Load Sample</button> -->
            </div>
        </form>

        <div class="output-section" id="outputSection" style="display: none;">
            <h2>Generated JSON</h2>
            <div class="output-container">
                <div class="copy-feedback" id="copyFeedback">Copied to clipboard!</div>
                <pre class="json-output" id="jsonOutput"></pre>
            </div>
        </div>
    </div>

    <!-- Back Button -->
    <a href="../../../index.html">
      <div class="back-button">
        <p>Back</p>
      </div>
    </a>

    <script>
        const form = document.getElementById('cosmosForm');
        let generatedJSON = null;

        function initializeForm() {
            // Start with empty form ready for input
        }

        function generateJSON() {
            clearErrors();

            // Collect indications
            const indications = [];
            document.querySelectorAll('#indicationsContainer .dynamic-item').forEach(item => {
                const id = item.querySelector('.indication-id').value.trim();
                const name = item.querySelector('.indication-name').value.trim();
                if (id && name) {
                    indications.push({
                        IndicationId: parseInt(id),
                        Name: name
                    });
                }
            });

            // Collect templates
            const templates = [];
            document.querySelectorAll('#templatesContainer .template-item').forEach((item, index) => {
                const name = item.querySelector('.template-name').value.trim();
                const clientId = item.querySelector('.template-client-id').value.trim();
                const filename = item.querySelector('.template-filename').value.trim();
                const productId = item.querySelector('.template-product-id').value.trim();
                const templateId = item.querySelector('.template-id').value.trim();
                const projectId = item.querySelector('.template-project-id').value.trim();

                if (name && clientId && filename && productId && templateId && projectId) {
                    const template = {
                        ClientId: parseInt(clientId),
                        waypathName: item.querySelector('.template-waypath').value.trim() || name,
                        TemplateName: name,
                        TemplateFileName: filename,
                        TemplateEmailFileName: item.querySelector('.template-email-filename').value.trim() || `${filename.replace('.html', '')}-email.html`,
                        FileName: filename,
                        documentId: "244",
                        TemplateType: item.querySelector('.template-type').value.trim() || name,
                        TemplateProductId: parseInt(productId),
                        TemplateId: parseInt(templateId),
                        ProjectId: parseInt(projectId),
                        IndicationIds: item.querySelector('.template-indications').value.trim() 
                            ? item.querySelector('.template-indications').value.trim().split(',').map(i => parseInt(i.trim()))
                            : [],
                        Channels: [
                            "Commercial",
                            "Medicare",
                            "Medicaid",
                            "Health Exchange"
                        ],
                        Filters: [
                            {
                                "CardDataField": "ftv_coverage",
                                "FilterDescription": "coverage"
                            },
                            {
                                "CardDataField": "channel",
                                "FilterDescription": "channel"
                            }
                        ],
                        QuickFilter: {
                            "SortBy": [
                                {
                                    "Title": "Lives",
                                    "DataField": "CoveredLives",
                                    "Default": true
                                }
                            ]
                        }
                    };
                    templates.push(template);
                }
            });

            // Create output document
            const outputDocument = {
                templates: templates,
                Indications: indications
            };

            generatedJSON = outputDocument;
            const jsonString = JSON.stringify(outputDocument, null, 2);

            document.getElementById('jsonOutput').textContent = jsonString;
            document.getElementById('outputSection').style.display = 'block';
            document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
        }

        function copyJSON() {
            if (!generatedJSON) {
                alert('Please generate JSON first');
                return;
            }

            const jsonString = JSON.stringify(generatedJSON, null, 2);
            navigator.clipboard.writeText(jsonString).then(() => {
                showCopyFeedback();
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }

        function downloadJSON() {
            if (!generatedJSON) {
                alert('Please generate JSON first');
                return;
            }

            const jsonString = JSON.stringify(generatedJSON, null, 2);
            const fileName = `cosmos-${new Date().getTime()}.json`;
            
            const element = document.createElement('a');
            element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(jsonString));
            element.setAttribute('download', fileName);
            element.style.display = 'none';
            
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        function clearForm() {
            form.reset();
            generatedJSON = null;
            document.getElementById('outputSection').style.display = 'none';
            clearErrors();
        }

        function clearErrors() {
            const errorElements = document.querySelectorAll('.validation-error');
            errorElements.forEach(el => el.textContent = '');
        }

        function showCopyFeedback() {
            const feedback = document.getElementById('copyFeedback');
            feedback.classList.add('show');
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 2000);
        }

        function addIndication() {
            const container = document.getElementById('indicationsContainer');
            const template = container.querySelector('.dynamic-item').cloneNode(true);
            template.querySelectorAll('input').forEach(input => input.value = '');
            container.appendChild(template);
        }

        function removeIndication(button) {
            const container = document.getElementById('indicationsContainer');
            if (container.querySelectorAll('.dynamic-item').length > 1) {
                button.closest('.dynamic-item').remove();
            } else {
                alert('At least one indication is required');
            }
        }

        function addTemplate() {
            const container = document.getElementById('templatesContainer');
            const items = container.querySelectorAll('.template-item');
            const newIndex = items.length + 1;
            const template = container.querySelector('.template-item').cloneNode(true);
            template.querySelectorAll('input').forEach(input => input.value = '');
            template.querySelector('summary').textContent = `Template ${newIndex}`;
            template.querySelector('details').setAttribute('open', '');
            container.appendChild(template);
        }

        function removeTemplate(button) {
            const container = document.getElementById('templatesContainer');
            if (container.querySelectorAll('.template-item').length > 1) {
                button.closest('.template-item').remove();
                updateTemplateSummaries();
            } else {
                alert('At least one template is required');
            }
        }

        function updateTemplateSummaries() {
            document.querySelectorAll('#templatesContainer .template-item').forEach((item, index) => {
                item.querySelector('summary').textContent = `Template ${index + 1}`;
            });
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            initializeForm();
        });
    </script>
</body>
</html>